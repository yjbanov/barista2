<!doctype html>
<html>
<body>
<div id="host"></div>

<script type="application/javascript">
    function allReady() {
        var renderFrame = Module.cwrap('RenderFrame', 'string', []);
        var dispatchEvent = Module.cwrap('DispatchEvent', 'void', ['string', 'string']);
        var host = document.querySelector('#host');
        host.addEventListener("click", function(event) {
            // Look for the nearest parent with a _bid, then dispatch to it.
            var bid = null;
            var parent = event.target;
            while(bid == null && parent) {
                bid = parent.getAttribute("_bid");
                parent = parent.parentNode;
            }
            if (bid) {
                dispatchEvent("click", bid);
            } else {
                console.log(">>> caught event on target with no _bid:", event.target);
            }
        });
        var diff = JSON.parse(renderFrame());
        if (diff.hasOwnProperty("create")) {
            console.log(diff["create"]);
            host.innerHTML = diff["create"];
        }
    }
</script>
<script src="main.js"></script>
</body>
</html>
